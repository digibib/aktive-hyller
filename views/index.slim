== render :slim, :'header'

div[id="nysgjerrig-tittel"] Nysgjerrig på boka?
img[id="frontbook" src="/img/bok.png"]
img[id="frontarrow" src="/img/pil.png"] 
div[id="nysgjerrig-undertittel"] Legg den her og finn ut mer!
div id="vi-leter"
  p Vi leter etter boka, vennligst vent
    span[id="loading"]
  div id="avbryt"
    button[class="top-button" id="avbryt-knapp"] Avbryt
div[id="overlay"]

javascript:
  $(document).ready(function() {
    
    
    // Initialize
    var ws = new WebSocket("ws://localhost:4567/ws");
    
    $('button#avbryt-knapp').on('click', function() {
      $('#overlay').hide();
      $('#vi-leter').hide();
    });

    // loading animation
    i = 0;
    setInterval(function() {
        i = ++i % 4;
        $("#loading").html(""+Array(i+1).join("."));
    }, 500);


    // when titlenr is received from server via websocket:
    ws.onmessage = function(evt) {
      // show overlay
      $('#overlay').show();
      $('button#avbryt-knapp').html('Avbryt');
      $('#vi-leter p').html('Vi leter etter boka, vennligst vent <span id="loading"></span>')
      $('#vi-leter').show();
      
      check_format = $.get('/checkformat/'+evt.data);
      check_format.done(function(data) {
        if (data.accepted_format) {
          $('div#vi-leter p').html('Henter informasjon om "' + data.title + '" <span id="loading"></span>' );
          
          //hent all info til omtalevisning her
          request = $.get('/populate/'+evt.data);
    
          request.done(function(data) {
            window.location.replace("/omtale");
            console.log(data);
          });
    
          request.fail(function(message) {
            console.log(message);
            $('div#vi-leter p').html('Ops! Klarte ikke å finne noe om denne.');
            $('button#avbryt-knapp').html('OK');
          });
                    
        } else {
          $('div#vi-leter p').html('Beklager! Foreløpig kan jeg bare hjelpe deg<br/>med bøker og lydbøker');
          $('button#avbryt-knapp').html('OK');
        }          
          
      });
    }

    ws.onclose = function() {
      console.log("Websocket connection lost!");
    }

    ws.onopen = function() {
      console.log("Websocket connected!");
    }

  });
