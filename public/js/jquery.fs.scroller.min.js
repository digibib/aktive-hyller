/*
 * Scroller Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.6.0
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function m(b){var a=c.extend({},g,b||{});return c(this).each(function(){var b=c(this);if(!b.data("scroller")){var d;d='<div class="scroller-bar"><div class="scroller-track"><div class="scroller-handle">';d+="</div></div></div>";a.paddingRight=parseInt(b.css("padding-right"),10);a.paddingBottom=parseInt(b.css("padding-bottom"),10);b.addClass(a.customClass+" scroller").wrapInner('<div class="scroller-content" />').prepend(d);a.horizontal&&b.addClass("scroller-horizontal");var e=c.extend({$scroller:b, $content:b.find(".scroller-content"),$bar:b.find(".scroller-bar"),$track:b.find(".scroller-track"),$handle:b.find(".scroller-handle")},a);e.$content.on("scroll.scroller",e,h);e.$scroller.on("mousedown.scroller",".scroller-track",e,n).on("mousedown.scroller",".scroller-handle",e,p).data("scroller",e);f.reset.apply(b,[e]);c(window).one("load",function(){f.reset.apply(b,[e])})}})}function h(b){b.preventDefault();b.stopPropagation();b=b.data;if(!0==b.horizontal){var a=b.$content.scrollLeft();0>a&&(a= 0);a/=b.scrollRatio;a>b.handleBounds.right&&(a=b.handleBounds.right);b.$handle.css({left:a})}else a=b.$content.scrollTop(),0>a&&(a=0),a/=b.scrollRatio,a>b.handleBounds.bottom&&(a=b.handleBounds.bottom),b.$handle.css({top:a})}function n(b){b.preventDefault();b.stopPropagation();var a=b.data,j=a.$track.offset();!0==a.horizontal?(a.mouseStart=b.pageX,a.handleLeft=b.pageX-j.left-a.handleWidth/2,d.apply(a.$scroller,[a,a.handleLeft])):(a.mouseStart=b.pageY,a.handleTop=b.pageY-j.top-a.handleHeight/2,d.apply(a.$scroller, [a,a.handleTop]));a.$scroller.data("scroller",a);a.$content.off(".scroller");c("body").on("mousemove.scroller",a,k).on("mouseup.scroller",a,l)}function p(b){b.preventDefault();b.stopPropagation();var a=b.data;!0==a.horizontal?(a.mouseStart=b.pageX,a.handleLeft=parseInt(a.$handle.css("left"),10)):(a.mouseStart=b.pageY,a.handleTop=parseInt(a.$handle.css("top"),10));a.$scroller.data("scroller",a);a.$content.off(".scroller");c("body").on("mousemove.scroller",a,k).on("mouseup.scroller",a,l)}function k(b){b.preventDefault(); b.stopPropagation();var a=b.data,c=0;!0==a.horizontal?(b=a.mouseStart-b.pageX,c=a.handleLeft-b):(b=a.mouseStart-b.pageY,c=a.handleTop-b);d.apply(a.$scroller,[a,c])}function l(b){b.preventDefault();b.stopPropagation();b=b.data;b.$content.on("scroll.scroller",b,h);c("body").off(".scroller")}function d(b,a){if(!0==b.horizontal){a<b.handleBounds.left&&(a=b.handleBounds.left);a>b.handleBounds.right&&(a=b.handleBounds.right);var c=Math.round(a*b.scrollRatio);b.$handle.css({left:a});b.$content.scrollLeft(c)}else a< b.handleBounds.top&&(a=b.handleBounds.top),a>b.handleBounds.bottom&&(a=b.handleBounds.bottom),c=Math.round(a*b.scrollRatio),b.$handle.css({top:a}),b.$content.scrollTop(c)}var g={customClass:"",trackMargin:0,handleSize:!1,horizontal:!1},f={defaults:function(b){g=c.extend(g,b||{});return c(this)},destroy:function(){return c(this).each(function(){var b=c(this).data("scroller");b&&(b.$scroller.removeClass(b.customClass).removeClass("scroller").removeClass("scroller-active"),b.$content.replaceWith(b.$content.html()), b.$bar.remove(),b.$content.unbind("scroll",h),b.$scroller.off(".scroller").removeData("scroller"))})},scroll:function(b){var a=c(this).data("scroller");"number"!=typeof b&&(b=c(b),0<b.length?(b=b.position(),b=!0==a.horizontal?b.left+a.$content.scrollLeft():b.top+a.$content.scrollTop()):b=a.$content.scrollTop());!0==a.horizontal?a.$content.scrollLeft(b):a.$content.scrollTop(b);return c(this)},reset:function(b){return c(this).each(function(){var a=b||c(this).data("scroller");if("undefined"!=typeof a){a.$scroller.addClass("scroller-setup"); if(!0==a.horizontal)a.barHeight=a.$content[0].offsetHeight-a.$content[0].clientHeight,a.frameWidth=a.$content.outerWidth(),a.trackWidth=a.frameWidth-2*a.trackMargin,a.scrollWidth=a.$content[0].scrollWidth,a.ratio=a.trackWidth/a.scrollWidth,a.trackRatio=a.trackWidth/a.scrollWidth,a.handleWidth=a.handleSize?a.handleSize:a.trackWidth*a.trackRatio,a.scrollRatio=(a.scrollWidth-a.frameWidth)/(a.trackWidth-a.handleWidth),a.handleBounds={left:0,right:a.trackWidth-a.handleWidth},a.$scroller.data("scroller", a),a.$content.css({paddingBottom:a.barHeight+a.paddingBottom}),a.$content.scrollLeft(),a.scrollWidth<=a.frameWidth?a.$scroller.removeClass("scroller-active"):a.$scroller.addClass("scroller-active"),a.$bar.css({width:a.frameWidth}),a.$track.css({width:a.trackWidth,marginLeft:a.trackMargin,marginRight:a.trackMargin}),a.$handle.css({width:a.handleWidth});else{a.barWidth=a.$content[0].offsetWidth-a.$content[0].clientWidth;a.frameHeight=a.$content.outerHeight();a.trackHeight=a.frameHeight-2*a.trackMargin; a.scrollHeight=a.$content[0].scrollHeight;a.ratio=a.trackHeight/a.scrollHeight;a.trackRatio=a.trackHeight/a.scrollHeight;a.handleHeight=a.handleSize?a.handleSize:a.trackHeight*a.trackRatio;a.scrollRatio=(a.scrollHeight-a.frameHeight)/(a.trackHeight-a.handleHeight);a.handleBounds={top:0,bottom:a.trackHeight-a.handleHeight};a.$scroller.data("scroller",a);var f=a.$content.scrollTop()*a.ratio;a.scrollHeight<=a.frameHeight?a.$scroller.removeClass("scroller-active"):a.$scroller.addClass("scroller-active"); a.$bar.css({height:a.frameHeight});a.$track.css({height:a.trackHeight,marginBottom:a.trackMargin,marginTop:a.trackMargin});a.$handle.css({height:a.handleHeight})}d.apply(a.$scroller,[a,f]);a.$scroller.removeClass("scroller-setup")}})}};c.fn.scroller=function(b){return f[b]?f[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof b||!b?m.apply(this,arguments):this}})(jQuery);